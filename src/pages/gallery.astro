---
import { readdir } from "node:fs/promises";
import Footer from "../components/Footer.astro";
import Navigation from "../components/Navigation.astro";
import TopBar from "../components/TopBar.astro";

const pageTitle = "Gallery | Edwards Landscape Group - Lawn Care & Landscaping in Lynchburg, VA";

const galleryCollections = [
  {
    id: "mowing",
    eyebrow: "Mowing & turf care",
    title: "Weekly routes & pristine stripes",
    copy: "See the crisp lines and consistent cuts our mowing crews deliver season after season.",
    ctaLabel: "Explore mowing",
    ctaLink: "/services/mowing.html",
    folder: "Mowing",
  },
  {
    id: "mulching",
    eyebrow: "Mulching & bed care",
    title: "Crisp edges, full beds",
    copy: "Fresh mulch, sharp bed lines, and healthy planting beds that frame every home.",
    ctaLabel: "Mulching services",
    ctaLink: "/services/mulching.html",
    folder: "Mulching",
  },
  {
    id: "hardscaping",
    eyebrow: "Hardscaping & outdoor living",
    title: "Patios, walls, and living areas",
    copy: "Design-build hardscapes that pair stonework with softscape plantings.",
    ctaLabel: "Hardscaping",
    ctaLink: "/services/hardscaping.html",
    folder: "Hardscaping",
  },
  {
    id: "landscape-design",
    eyebrow: "Landscape design & installation",
    title: "Custom designs for every home",
    copy: "Beautiful, functional outdoor spaces designed and built to complement each property.",
    ctaLabel: "Landscape design",
    ctaLink: "/services/landscape-design.html",
    folder: "Landscape-Design",
  },
];

const imageExtensions = new Set([".jpg", ".jpeg", ".png", ".webp", ".avif", ".gif"]);

async function getCollectionImages(folder: string) {
  const folderPath = new URL(`../../public/assets/${folder}`, import.meta.url);

  try {
    const entries = await readdir(folderPath, { withFileTypes: true });

    return entries
      .filter((entry) => entry.isFile())
      .map((entry) => entry.name)
      .filter((file) => imageExtensions.has(file.slice(file.lastIndexOf(".")).toLowerCase()))
      .sort((a, b) => a.localeCompare(b, undefined, { numeric: true }))
      .map((fileName) => `/assets/${folder}/${fileName}`);
  } catch {
    return [];
  }
}

const collectionsWithImages = await Promise.all(
  galleryCollections.map(async (collection) => ({
    ...collection,
    images: await getCollectionImages(collection.folder),
  })),
);

const populatedCollections = collectionsWithImages.filter((collection) => collection.images.length > 0);
---

<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3TXVE0LR1X"></script>
  <script>
    (window as any).dataLayer = (window as any).dataLayer || [];
    (window as any).gtag = function () {
      (window as any).dataLayer.push(arguments);
    };
    (window as any).gtag("js", new Date());
    (window as any).gtag("config", "G-3TXVE0LR1X");
  </script>
  <title>{pageTitle}</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta
    name="description"
    content="Browse our gallery to see Edwards Landscape Group's professional lawn care and landscaping work in Lynchburg and surrounding areas. View examples of mowing, mulching, seasonal cleanups, and more."
  />

  <link id="favicon" rel="icon" type="image/png" href="/assets/favicon.ico" />
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
  />

  <link rel="stylesheet" href="/css/animate.css" />
  <link rel="stylesheet" href="/css/owl.carousel.min.css" />
  <link rel="stylesheet" href="/css/owl.theme.default.min.css" />
  <link rel="stylesheet" href="/css/magnific-popup.css" />
  <link rel="stylesheet" href="/css/ionicons.min.css" />
  <link rel="stylesheet" href="/css/flaticon.css" />
  <link rel="stylesheet" href="/css/icomoon.css" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <TopBar />
  <Navigation />

  <section class="page-hero" style="background-image: url('/assets/bg_3.jpg');">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-xl-6 hero-content-block">
          <h1 class="mb-3">See what we've built and maintained</h1>
          <p class="mb-4">
            Browse grouped collections of our mowing, mulching, bed care, and design-build projects.
            Click any image to view it larger.
          </p>
        </div>
      </div>
    </div>
  </section>

  <section class="ftco-section gallery-section">
    <div class="container">
      <div class="row justify-content-center mb-5 pb-3">
        <div class="col-md-12 heading-section text-center ftco-animate">
          <span class="subheading">Our Work</span>
          <h2 class="mb-2 section-title">Project Gallery</h2>
          <p class="section-subtitle">
            Browse highlights from each service category. Tap any thumbnail to open a larger view
            and swipe through that service's carousel.
          </p>
        </div>
      </div>

      {populatedCollections.map((collection) => (
        <div class="gallery-collection" id={`gallery-${collection.id}`}>
          <header class="gallery-collection__header">
            <div>
              <p class="eyebrow">{collection.eyebrow}</p>
              <h3 class="gallery-collection__title">{collection.title}</h3>
              <p class="gallery-collection__copy">{collection.copy}</p>
            </div>
            <a href={collection.ctaLink} class="gallery-collection__cta">{collection.ctaLabel}</a>
          </header>
          <div class="gallery-carousel owl-carousel">
            {collection.images.map((imageSrc, index) => (
              <figure class="gallery-card">
                <a
                  href={imageSrc}
                  class="gallery-lightbox image-popup"
                  aria-label={`${collection.title} image ${index + 1}`}
                  title={`${collection.title} ${index + 1}`}
                >
                  <img
                    src={imageSrc}
                    loading="lazy"
                    decoding="async"
                    alt={`${collection.title} project photo ${index + 1}`}
                    width="960"
                    height="640"
                    class="gallery-thumb"
                  />
                  <figcaption class="gallery-overlay">
                    <span>{collection.ctaLabel}</span>
                    <i class="icon-expand" aria-hidden="true"></i>
                  </figcaption>
                </a>
              </figure>
            ))}
          </div>
        </div>
      ))}
    </div>
  </section>

  <Footer />

  <div id="ftco-loader" class="show fullscreen">
    <svg class="circular" width="48px" height="48px"
      ><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"
      ></circle><circle
        class="path"
        cx="24"
        cy="24"
        r="22"
        fill="none"
        stroke-width="4"
        stroke-miterlimit="10"
        stroke="#F96D00"></circle></svg
    >
  </div>

  <script src="/js/jquery.min.js" is:inline></script>
  <script src="/js/jquery-migrate-3.0.1.min.js" is:inline></script>
  <script src="/js/popper.min.js" is:inline></script>
  <script src="/js/bootstrap.min.js" is:inline></script>
  <script src="/js/jquery.easing.1.3.js" is:inline></script>
  <script src="/js/jquery.waypoints.min.js" is:inline></script>
  <script src="/js/jquery.stellar.min.js" is:inline></script>
  <script src="/js/owl.carousel.min.js" is:inline></script>
  <script src="/js/jquery.magnific-popup.min.js" is:inline></script>
  <script src="/js/scrollax.min.js" is:inline></script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"
  ></script>
  <script src="/js/google-map.js" is:inline></script>
  <script src="/js/main.js" is:inline></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>
  <script>
    (window as any).dataLayer = (window as any).dataLayer || [];
    function gtag(...args: any[]) {
      ((window as any).dataLayer as any[]).push(args);
    }
    gtag("js", new Date());
    gtag("config", "UA-23581568-13");
  </script>
</body>
